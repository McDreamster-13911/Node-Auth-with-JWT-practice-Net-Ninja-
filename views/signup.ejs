<%- include('partials/header'); -%>

<form id="signupForm">
    <h2>Sign up</h2>

    <!-- Email Input -->
    <label for="email">Email</label>
    <input type="text" name="email" id="email" required>
    <div class="email error"></div>

    <!-- Password Input -->
    <label for="password">Password</label>
    <input type="password" name="password" id="password" required>
    <div class="password error"></div>

    <!-- Submit Button -->
    <button type="submit">Sign up</button>
</form>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        // Select form and error message divs
        const form = document.querySelector("#signupForm");
        const emailError = document.querySelector(".email.error");
        const passwordError = document.querySelector(".password.error");

        // Add submit event listener
        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            // Clear previous errors
            emailError.textContent = "";
            passwordError.textContent = "";

            // Get the values from the form
            const email = form.email.value;
            const password = form.password.value;

            try {
                // Send POST request to /signup
                const res = await fetch("/signup", {
                    method: "POST",
                    body: JSON.stringify({ email: email, password: password }),
                    headers: { "Content-Type": "application/json" },
                });

                // Parse response
                const data = await res.json();

                // Handle errors or success
                if (res.status === 400) {
                    // Display validation errors
                    if (data.email) emailError.textContent = data.email;
                    if (data.password) passwordError.textContent = data.password;
                } else if (res.ok) {
                    // Redirect or show success message
                    console.log("User signed up successfully:", data);
                    location.assign("/");
                }
            } catch (err) {
                console.error("An error occurred:", err);
            }
        });
    });
</script>

<%- include('partials/footer'); -%>
